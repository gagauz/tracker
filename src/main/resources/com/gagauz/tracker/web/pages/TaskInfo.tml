<html t:type="layout" title="task header info"
      xmlns:t="http://tapestry.apache.org/schema/tapestry_5_3.xsd"
      xmlns:p="tapestry:parameter">

<div class="task-info">
    <t:TaskHeader task="task"/>
    
    <h2>Attachments</h2>
    <div class="block">
    </div>
    
    <h2>Description</h2>
    <div class="block">
    ${task.description}
    </div>
    
    <h2>Comments</h2>
    <div class="block">
    </div>
    
    <h2>Stages</h2>
    <div class="block">
    	<t:loop source="stages" value="stage">
    	</t:loop>
    </div>
    
    <h2>Code changes</h2>
    <div id="code-changes" class="block">
    	<img src="/static/i/loading_bar_gray.gif" />
    </div>
    
    <div t:id="zone">
		<t:loop source="commits" value="commit">
		<div class="commit">
			<div class="date"><b>${date:commit.date}</b>&#160;<i>${commit.hash}</i> by <a href="#${commit.author}">${commit.author}</a></div>
			<div class="comm">${commit.comment}</div>
			<ul class="deta"><t:outputraw value="formatDetails(commit.getDetails())"/></ul>
		</div>
		</t:loop>
	</div>
    
    <script type="text/javascript">
    	$j(document).ready(function(){
    		$j.ajax('${ajaxUrl}', {
    			success: function(json, status) {
    				$j('#code-changes').html(json["content"]);
    			},
    			error: function(xhr, status, error) {
    				$j('#code-changes').html('<div class="t-error">' + status + ': ' + error + '</div>');
    			}
    		});
    	});
    </script>
</div>
</html>
